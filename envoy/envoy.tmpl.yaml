static_resources:
  listeners:
    - name: listener_0
      address:
        socket_address:
          address: 0.0.0.0
          port_value: 8082
      filter_chains:
        - filters:
            - name: envoy.filters.network.http_connection_manager
              typed_config:
                "@type": type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager
                codec_type: AUTO
                stat_prefix: ingress_http
                tracing:
                  spawn_upstream_span: true
                  provider:
                    name: envoy.tracers.opentelemetry
                    typed_config:
                      "@type": type.googleapis.com/envoy.config.trace.v3.OpenTelemetryConfig
                      grpc_service:
                        envoy_grpc:
                          cluster_name: opentelemetry_collector_grpc
                        timeout: 0.250s
                      service_name: frontend-proxy
                      resource_detectors:
                        - name: envoy.tracers.opentelemetry.resource_detectors.environment
                          typed_config:
                            "@type": type.googleapis.com/envoy.extensions.tracers.opentelemetry.resource_detectors.v3.EnvironmentResourceDetectorConfig
                route_config:
                  name: grpc_routes
                  virtual_hosts:
                    - name: grpc_local_service
                      domains:
                        - '*'
                      routes:
                        - match:
                            prefix: /loginservice.LoginService
                          route:
                            cluster: authorization-service-cluster
                            max_grpc_timeout: 0s
                        - match:
                            prefix: /executionvenue.ExecutionVenue
                          route:
                            cluster: order-router-cluster
                            max_grpc_timeout: 0s
                        - match:
                            prefix: /marketdataservice.MarketDataService
                          route:
                            cluster: market-data-service-cluster
                            max_grpc_timeout: 0s
                        - match:
                            prefix: /orderdataservice.OrderDataService
                          route:
                            cluster: order-data-service-cluster
                            max_grpc_timeout: 0s
                        - match:
                            prefix: /staticdataservice.StaticDataService
                          route:
                            cluster: static-data-service-cluster
                            max_grpc_timeout: 0s
                        - match:
                            prefix: /ordermonitor.OrderMonitor
                          route:
                            cluster: order-monitor-cluster
                            max_grpc_timeout: 0s
                        - match:
                            prefix: /clientconfigservice.ClientConfigService
                          route:
                            cluster: client-config-service-cluster
                            max_grpc_timeout: 0s
                        - match:
                            prefix: /
                          route:
                            cluster: opentp-client-cluster
                http_filters:
                  - name: envoy.filters.http.fault
                    typed_config:
                      "@type": type.googleapis.com/envoy.extensions.filters.http.fault.v3.HTTPFault
                      max_active_faults: 100
                      delay:
                        header_delay: {}
                        percentage:
                          numerator: 100
                  - name: envoy.filters.http.router
                    typed_config:
                      "@type": type.googleapis.com/envoy.extensions.filters.http.router.v3.Router
                          # per_filter_config:
                          #   envoy.ext_authz:
                          #     disabled: true
                          #   envoy.grpc_web:
                          #     disabled: true
                      # cors:
                      #   allow_origin:
                      #     - '*'
                      #   allow_methods: 'GET, PUT, DELETE, POST, OPTIONS'
                      #   allow_headers: >-
                      #     keep-alive,user-agent,cache-control,content-type,content-transfer-encoding,custom-header-1,x-accept-content-transfer-encoding,x-accept-response-streaming,x-user-agent,x-grpc-web,grpc-timeout,user-name,app-instance-id,auth-token
                      #   max_age: '1728000'
                      #   expose_headers: 'custom-header-1,grpc-status,grpc-message'
                # http_filters:
                #   - name: envoy.cors
                #   - name: envoy.ext_authz
                #     typed_config:
                #       grpc_service:
                #         envoy_grpc:
                #           cluster_name: ext-authz
                #         timeout: 0.5s
                #   - name: envoy.grpc_web
                #   - name: envoy.router
  clusters:
    - name: opentp-client-cluster
      connect_timeout: 0.25s
      type: STRICT_DNS
      lb_policy: round_robin
      load_assignment:
        cluster_name: opentp-client
        endpoints:
          - lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: opentp-client.default
                      port_value: 80
    - name: authorization-service-cluster
      connect_timeout: 0.25s
      type: STRICT_DNS
      lb_policy: round_robin
      load_assignment:
        cluster_name: authorization-service
        endpoints:
          - lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: authorization-service.default
                      port_value: 50551
    - name: market-data-service-cluster
      connect_timeout: 0.25s
      type: STRICT_DNS
      lb_policy: round_robin
      load_assignment:
        cluster_name: market-data-service
        endpoints:
          - lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: market-data-service.default
                      port_value: 50551
    - name: order-data-service-cluster
      connect_timeout: 0.25s
      type: STRICT_DNS
      lb_policy: round_robin
      load_assignment:
        cluster_name: order-data-service
        endpoints:
          - lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: order-data-service.default
                      port_value: 50551
    - name: order-router-cluster
      connect_timeout: 0.25s
      type: STRICT_DNS
      lb_policy: round_robin
      load_assignment:
        cluster_name: order-router
        endpoints:
          - lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: order-router.default
                      port_value: 50581
    - name: static-data-service-cluster
      connect_timeout: 0.25s
      type: STRICT_DNS
      lb_policy: round_robin
      load_assignment:
        cluster_name: static-data-service
        endpoints:
          - lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: static-data-service.default
                      port_value: 50551
    - name: order-monitor-cluster
      connect_timeout: 0.25s
      type: STRICT_DNS
      lb_policy: round_robin
      load_assignment:
        cluster_name: order-monitor
        endpoints:
          - lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: order-monitor.default
                      port_value: 50551
    - name: client-config-service-cluster
      connect_timeout: 0.25s
      type: STRICT_DNS
      lb_policy: round_robin
      load_assignment:
        cluster_name: client-config-service
        endpoints:
          - lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: client-config-service.default
                      port_value: 50551
    - name: ext-authz
      connect_timeout: 0.25s
      type: STRICT_DNS
      lb_policy: round_robin
      load_assignment:
        cluster_name: ext-authz
        endpoints:
          - lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: authorization-service.default
                      port_value: 4000
admin:
  access_log_path: /tmp/admin_access.log
  address:
    socket_address:
      address: 0.0.0.0
      port_value: 10000
layered_runtime:
  layers:
    - name: static_layer_0
      static_layer:
        envoy:
          resource_limits:
            listener:
              example_listener_name:
                connection_limit: 10000